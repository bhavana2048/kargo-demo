name: Sample GitHub Actions Structure

# Triggers
on:
  # Manual trigger with inputs
  workflow_dispatch:
    inputs:
      environment:
        description: "Select the environment to run this workflow"
        required: true
        default: "dev"
        type: choice
        options:
          - dev
          - staging
          - prod

  # Scheduled trigger (runs every day at 8 AM UTC)
  schedule:
    - cron: "0 8 * * *"

# Global environment variables (optional)
env:
  GLOBAL_MESSAGE: "Hello from the top-level workflow env!"

jobs:
  # ───────────────────────────────
  setup:
    name: Setup Job
    runs-on: ubuntu-latest
    steps:
      - name: Print workflow trigger info
        run: echo "Workflow triggered by ${{ github.event_name }}"
      
      - name: Print input environment
        run: echo "Running in environment:${{ github.event.inputs.environment }}"
      
      - name: Print global env
        run: echo "Global message:$GLOBAL_MESSAGE"
  run:
    name: Build Job (with Matrix)
    runs-on: ubuntu-latest
    needs: setup
    strategy:
      matrix:
        node-version: [14, 16, 18]
        os: [ubuntu-latest, windows-latest]
        exclude:
          - os: windows-latest
            node-version: 14
    steps:
      - name: Print matrix details
        run: echo "Running build on OS=${{ matrix.os }} with Node.js version=${{ matrix.node-version }}"

      - name: Simulate build step
        run: echo "Building project for ${{ matrix.os }} and Node version ${{ matrix.node-version }}"

  test:
    name: Test Job
    runs-on: ubuntu-latest
    needs: run
    steps:
      - name: Print test start
        run: echo "Starting tests after build"

      - name: Simulate tests
        run: |
          echo "Running test step 1"
          echo "Running test step 2"
          echo "All tests passed successfully!"
  deploy:
    name: Deploy Job
    runs-on: ubuntu-latest
    needs: test
    if: ${{ github.event.inputs.environment == 'prod' }}
    steps:
      - name: Deployment condition
        run: echo "Deploying to Production because environment=${{ github.event.inputs.environment }}"
      
      - name: Simulate deploy
        run: echo " Deployment completed successfully!"

      - name: Create a random text file
        run: |
          echo "This is a sample artifact file generated at $(date)" > doc/sample_output.txt
          echo "Previous job result: ${{ needs.run.result }}" >> doc/sample_output.txt
          echo "Environment: ${{ github.event.inputs.environment }}" >> doc/sample_output.txt

      - name: Upload artifact file
        uses: actions/upload-artifact@v4
        with:
          name: sample-artifact
          path: doc/sample_output.txt

